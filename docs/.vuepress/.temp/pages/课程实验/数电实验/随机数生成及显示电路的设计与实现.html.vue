<template><div><h2 id="实验任务题目" tabindex="-1"><a class="header-anchor" href="#实验任务题目" aria-hidden="true">#</a> 实验任务题目</h2>
<p>用VHDL语言实现一个带复位功能的三位随机数产生和显示电路，具体功能如下：</p>
<ul>
<li>
<p>在数码管 DISP7-DISP3 上稳定显示班级和班内序号，如： 201 班 1号同学显示“20101”；同时在数码管 DISP2-DISP0 上显示三位随机数，显示的随机数内容每2秒变换一次；</p>
</li>
<li>
<p>一个BTN用作复位键，按动复位键后，数码管 DISP2-DISP0显示为“000”，2秒后再次进入随机数显示和2秒切换的模式， 而DISP7-DISP3 上显示的内容不变。</p>
</li>
<li>
<p>输入时钟1MHz。</p>
</li>
</ul>
<p>注意：每次清零后重新开始显示的随机数不能与上次清零后的随机数相同。</p>
<h2 id="对实验任务的理解与思考" tabindex="-1"><a class="header-anchor" href="#对实验任务的理解与思考" aria-hidden="true">#</a> 对实验任务的理解与思考</h2>
<blockquote>
<p><strong>关于随机和伪随机</strong></p>
<ul>
<li>单纯的数学算法只能产生伪随机数
<ul>
<li>利用<strong>M序列发生器</strong>产生伪随机数</li>
</ul>
</li>
<li>要产生真随机数，必须要有<strong>物理随机源</strong>的参与
<ul>
<li>两次按键之间的时间间隔</li>
<li>按键被按下的宽度或抖动的宽度</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="m序列产生伪随机数" tabindex="-1"><a class="header-anchor" href="#m序列产生伪随机数" aria-hidden="true">#</a> M序列产生伪随机数</h3>
<p>M序列的长度M=2<sup>k</sup>-1,其中k是移存器的位数。</p>
<p>反馈电路是某些触发器输出的<strong>异或</strong>加上校正项，校正项是先将k个触发器的输出“<strong>或非</strong>”，再将这个或非结果和原来的反馈输出再次进行“异或”运算:</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mn>0</mn></msub><mo>=</mo><msub><mi>D</mi><mn>0</mn></msub><mo>⊕</mo><mover accent="true"><mrow><msub><mi>Q</mi><mrow><mi>K</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>Q</mi><mrow><mi>K</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>Q</mi><mn>2</mn></msub><mo>+</mo><msub><mi>Q</mi><mn>1</mn></msub><mo>+</mo><msub><mi>Q</mi><mn>0</mn></msub></mrow><mo stretchy="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">
D_0=D_0	\oplus\overline{Q_{K-1} + Q_{K-2} + ... +Q_{2} + Q_{1} + Q_{0}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0917em;vertical-align:-0.2083em;"></span><span class="mord overline"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>M序列发生器的设计已经定型化，一般只需查表即可。</p>
<table>
<thead>
<tr>
<th style="text-align:center">k</th>
<th style="text-align:center">M=2<sup>k</sup>-1_1</th>
<th style="text-align:center">反馈函数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">7</td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>0</mn></msub><mo>⊕</mo><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Q_0\oplus Q_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>或<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub><mo>⊕</mo><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Q_1\oplus Q_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">15</td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>0</mn></msub><mo>⊕</mo><msub><mi>Q</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">Q_0\oplus Q_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>或<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>2</mn></msub><mo>⊕</mo><msub><mi>Q</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">Q_2\oplus Q_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">31</td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub><mo>⊕</mo><msub><mi>Q</mi><mn>4</mn></msub></mrow><annotation encoding="application/x-tex">Q_1\oplus Q_4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>或<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>2</mn></msub><mo>⊕</mo><msub><mi>Q</mi><mn>4</mn></msub></mrow><annotation encoding="application/x-tex">Q_2\oplus Q_4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding="application/x-tex">\cdots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.313em;"></span><span class="minner">⋯</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding="application/x-tex">\cdots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.313em;"></span><span class="minner">⋯</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding="application/x-tex">\cdots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.313em;"></span><span class="minner">⋯</span></span></span></span></td>
</tr>
</tbody>
</table>
<h3 id="产生随机数的关键vhdl代码" tabindex="-1"><a class="header-anchor" href="#产生随机数的关键vhdl代码" aria-hidden="true">#</a> 产生随机数的关键vhdl代码：</h3>
<div class="language-vhdl ext-vhdl line-numbers-mode"><pre v-pre class="language-vhdl"><code><span class="token keyword">architecture</span> rtl <span class="token keyword">of</span> D201GS10_RandomNumber <span class="token keyword">is</span>    
	<span class="token keyword">signal</span> feedback <span class="token punctuation">:</span> std_logic<span class="token punctuation">;</span>
    <span class="token keyword">signal</span> q_temp <span class="token punctuation">:</span> <span class="token function">std_logic_vector</span><span class="token punctuation">(</span><span class="token number">11</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- is for M sequence</span>
	randomNum1<span class="token punctuation">:</span> <span class="token keyword">process</span> <span class="token punctuation">(</span>q_temp<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>q_temp<span class="token operator">=</span><span class="token vhdl-vectors number">"000000000000"</span><span class="token punctuation">)</span> <span class="token keyword">then</span> feedback <span class="token operator">&lt;=</span> <span class="token number">'1'</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> feedback <span class="token operator">&lt;=</span> <span class="token function">q_temp</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">xor</span> <span class="token function">q_temp</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">xor</span> <span class="token function">q_temp</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">xor</span> <span class="token function">q_temp</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">process</span><span class="token punctuation">;</span>
    
    randomNum2<span class="token punctuation">:</span> <span class="token keyword">process</span> <span class="token punctuation">(</span>clk<span class="token punctuation">,</span>feedback<span class="token punctuation">,</span>q_temp<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token comment">-- clk's period should be 2s,freq=0.5Hz;it is from 1kHz divider 2000</span>
        <span class="token keyword">if</span> clk<span class="token attribute attr-name">'event</span> <span class="token operator">and</span> clk<span class="token operator">=</span><span class="token number">'1'</span> <span class="token keyword">then</span> 
			q_temp <span class="token operator">&lt;=</span> <span class="token function">q_temp</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> feedback<span class="token punctuation">;</span>      
        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">process</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中<code v-pre>q_temp &lt;= q_temp(10 downto 0) &amp; feedback;</code>表示将q_temp的0到10位与feedback连接，再赋值给q_temp。</p>
<h2 id="电路的模块划分及作用" tabindex="-1"><a class="header-anchor" href="#电路的模块划分及作用" aria-hidden="true">#</a> 电路的模块划分及作用</h2>
<p>电路可划分为以下六个模块：</p>
<h3 id="计数器-count8" tabindex="-1"><a class="header-anchor" href="#计数器-count8" aria-hidden="true">#</a> 计数器(count8)</h3>
<Mermaid id="mermaid-64a56faa" code="flowchart%20LR%0A%20%20subgraph%20count8%0A%20%20direction%20LR%0A%20%20%20%20x(%22some%20operation%22)%20%20--%3E%20...%20--%3E%20y(%22some%20operation%22)%0A%20%20end%0A%20%20clk%20--%3E%20count8%20--%3E%20out(%22q_temp%5B2...0%5D%22)%0A%20%20%0A"></Mermaid><p>模值为8，其作用为动态扫描8个数码管。8个数码管的控制端口为</p>
<ul>
<li>段码：seg(7 downto 0)</li>
<li>位码：cat(7 downto 0)</li>
</ul>
<p>在某一确定的时刻，只有一个数码管亮，即任意时刻位码只含一个&quot;0&quot;；由于人眼的视觉暂留现象，人眼观察到8个数码管“同时显示”。</p>
<p>扫描的频率，即计数器变化的频率，需满足</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mo>≥</mo><mi>N</mi><mo>×</mo><msub><mi>f</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">
f ≥ N × f_0
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">f_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn><mi>H</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">50Hz</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">50</span><span class="mord mathnormal" style="margin-right:0.04398em;">Hz</span></span></span></span> ，在该实验板中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>= 8。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">f_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>取 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>k</mi><mi>H</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">1kHz</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal" style="margin-right:0.04398em;">Hz</span></span></span></span> 显然满足要求。</p>
<h3 id="按键消抖-debouncing" tabindex="-1"><a class="header-anchor" href="#按键消抖-debouncing" aria-hidden="true">#</a> 按键消抖(debouncing)</h3>
<Mermaid id="mermaid-64a56ef2" code="flowchart%20LR%0A%20%20subgraph%20debouncing%0A%20%20direction%20LR%0A%20%20%20%20x(%22some%20operation%22)%20%20--%3E%20...%20--%3E%20y(%22some%20operation%22)%0A%20%20end%0A%20%20btn%20--%3E%20debouncing%20--%3E%20btnout%0A%20%20clk%20--%3E%20debouncing%0A"></Mermaid><p>它的作用除了标题所言消抖，还有：按键一旦被按下（不管有没有弹开）后，2s内保持btnout输出高电平“1”，使显示译码的随机数部分复位保持2s再变化。</p>
<p>消抖的原理如下：</p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602181033266.png" alt="image-20220602181033266" loading="lazy"></p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602185634561.png" alt="image-20220602185634561" loading="lazy"></p>
<p>此处使用计数法消抖，计数器在btn为“1”时，对毫秒信号计数，计数值保存在num中。检测num的值，只有它大于某一数值（如30）时，btnout才输出“1”，否则输出“0”。</p>
<blockquote>
<p><strong>注意</strong></p>
<p>按键复位时应引入一计数值num，控制btnout输出高电平2s。</p>
</blockquote>
<h3 id="分频器-divider2000" tabindex="-1"><a class="header-anchor" href="#分频器-divider2000" aria-hidden="true">#</a> 分频器(divider2000)</h3>
<Mermaid id="mermaid-64a56928" code="flowchart%20LR%0A%20%20subgraph%20divider2000%0A%20%20direction%20LR%0A%20%20%20%20x(%22some%20operation%22)%20%20--%3E%20...%20--%3E%20y(%22some%20operation%22)%0A%20%20end%0A%20%20clk%20--%3E%20divider2000%20--%3E%20q(%22clk_2s%22)%0A"></Mermaid><p>它的作用是根据输入的1kHz信号获得周期为2s的时钟信号，直接或间接地使显示的随机数以2s的周期切换。分频器的基本原理是对输入信号计数，当计数值达到设定值时让输出信号翻转。此处是2000分频，计数值num上限是999。</p>
<blockquote>
<p><strong>注意</strong></p>
<p>按键复位随机数时，该分频信号也应该清零！且计数值num不是赋初值0，而是赋初值-999！否则清零时的“000”显示时间不足2s，清零后的第一次随机数显示亦不足2s！</p>
</blockquote>
<h3 id="m序列发生器-randomnumber" tabindex="-1"><a class="header-anchor" href="#m序列发生器-randomnumber" aria-hidden="true">#</a> M序列发生器(RandomNumber)</h3>
<Mermaid id="mermaid-64a568e0" code="flowchart%20LR%0A%20%20subgraph%20RandomNumber%0A%20%20direction%20LR%0A%20%20%20%20x(%22some%20operation%22)%20%20--%3E%20...%20--%3E%20y(%22some%20operation%22)%0A%20%20end%0A%20%20clk%20--%3E%20RandomNumber%20--%3E%20q(%22q_temp%5B11...0%5D%22)%0A"></Mermaid><p>它的作用是产生一组二进制（伪）随机数，这里取其中的12位。</p>
<blockquote>
<p><strong>为什么取12位？</strong></p>
<p>数码管上显示的三位随机数，每一位都是十进制（0~9），每一位十进制数最少需四位二进制数来表示，如按8421BCD码，0001表示1,0111表示7。</p>
<p>在显示译码时再把这12位切割成3个4位，分别译码。</p>
<p>另外按键复位时，也不要清M序列，M序列应使用高频信号，保证随机数变化足够快，复位后的第一次随机数显示才不会与上一次重复。</p>
</blockquote>
<h3 id="transfer" tabindex="-1"><a class="header-anchor" href="#transfer" aria-hidden="true">#</a> transfer</h3>
<Mermaid id="mermaid-64a56862" code="flowchart%20LR%0A%20%20subgraph%20transfer%0A%20%20direction%20LR%0A%20%20%20%20x(%22q_temp3%20%3C%3D%20q_temp%22)%20%0A%20%20end%0A%20%20clk_2s%20--%3E%20transfer%20--%3E%20q(%22q_temp3%5B11...0%5D%22)%0A"></Mermaid><p>它的作用仅是将从之前的M序列发生器的得到的随机数再赋给另一信号（变量），关键是这一操作<strong>每隔2s执行一次</strong>，这样就能实现每隔2s更新一次数码管显示的随机数。</p>
<h3 id="显示译码-decode" tabindex="-1"><a class="header-anchor" href="#显示译码-decode" aria-hidden="true">#</a> 显示译码(decode)</h3>
<h2 id="总体逻辑结构图-详细准确标注端口及内部信号" tabindex="-1"><a class="header-anchor" href="#总体逻辑结构图-详细准确标注端口及内部信号" aria-hidden="true">#</a> 总体逻辑结构图（详细准确标注端口及内部信号）</h2>
<Mermaid id="mermaid-64a56824" code="flowchart%20LR%0A%20%20subgraph%20D201GS10_RANDOMNUMBER%0A%20%20%20%20direction%20LR%0A%20%20%20%20subgraph%20count8%0A%20%20%20%20%20%20%20%20direction%20LR%0A%20%20%20%20end%0A%20%20%20%20subgraph%20debouncing%0A%20%20%20%20%20%20%20%20direction%20LR%0A%20%20%20%20end%0A%20%20%20%20subgraph%20divider2000%0A%20%20%20%20%20%20%20%20direction%20LR%0A%20%20%20%20end%0A%20%20%20%20subgraph%20transfer%0A%20%20%20%20%20%20%20%20direction%20LR%0A%20%20%20%20end%0A%20%20%20%20subgraph%20RandomNumber%0A%20%20%20%20%20%20%20%20direction%20LR%0A%20%20%20%20end%0A%20%20%20%20subgraph%20decode%0A%20%20%20%20%20%20%20%20direction%20LR%0A%20%20%20%20end%0A%20%20%20%20clk_0(%22clk%22)%20--%3E%20count8%20--%3E%20%7C%22q_temp2%5B2...0%5D%22%7C%20decode%0A%20%20%20%20clk_0%20--%3E%20debouncing%20--%3E%20%7Cbtnout%7C%20decode%0A%20%20%20%20btn_(%22btn%22)%20--%3E%20debouncing%0A%20%20%20%20clk_0%20--%3E%20divider2000%20--%3E%20%7Cclk_2s%7C%20transfer%20--%3E%20%7C%22t_temp3%5B11...0%5D%22%7C%20decode%0A%20%20%20%20clk_0%20--%3E%20RandomNumber%20--%3E%7C%22q_temp%5B11...0%5D%22%7C%20transfer%0A%20%20end%0A%20%20clk%20---%3E%20D201GS10_RANDOMNUMBER%20---%3E%20seg(%22seg%5B7..0%5D%22)%0A%20%20btn%20---%3E%20D201GS10_RANDOMNUMBER%20---%3E%20cat(%22cat%5B7..0%5D%22)%0A%20%20%0A"></Mermaid><h2 id="vhdl代码截图及编译成功截图" tabindex="-1"><a class="header-anchor" href="#vhdl代码截图及编译成功截图" aria-hidden="true">#</a> VHDL代码截图及编译成功截图</h2>
<h3 id="vhdl代码" tabindex="-1"><a class="header-anchor" href="#vhdl代码" aria-hidden="true">#</a> vhdl代码:</h3>
<div class="language-vhdl ext-vhdl line-numbers-mode"><pre v-pre class="language-vhdl"><code> <span class="token keyword">library</span> ieee<span class="token punctuation">;</span>
<span class="token keyword">use</span> ieee<span class="token punctuation">.</span>std_logic_1164<span class="token punctuation">.</span><span class="token keyword">all</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> ieee<span class="token punctuation">.</span>std_logic_unsigned<span class="token punctuation">.</span><span class="token keyword">all</span><span class="token punctuation">;</span>

<span class="token keyword">entity</span> D201GS10_RandomNumber <span class="token keyword">is</span>
    <span class="token keyword">port</span> <span class="token punctuation">(</span>
        clk   <span class="token punctuation">:</span> <span class="token keyword">in</span> std_logic<span class="token punctuation">;</span>
        btn <span class="token punctuation">:</span> <span class="token keyword">in</span> std_logic<span class="token punctuation">;</span>
        seg<span class="token punctuation">:</span> <span class="token keyword">out</span> <span class="token function">std_logic_vector</span><span class="token punctuation">(</span><span class="token number">7</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token keyword">others</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cat<span class="token punctuation">:</span> <span class="token keyword">out</span> <span class="token function">std_logic_vector</span><span class="token punctuation">(</span><span class="token number">7</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">-- qotmp: out std_logic_vector(3 downto 0);</span>
        <span class="token comment">-- qstmp: out std_logic_vector(3 downto 0);</span>
        <span class="token comment">-- qttmp: out std_logic_vector(3 downto 0)</span>
        <span class="token comment">-- numtmp: out integer range 0 to 1999; -- is for debouncing</span>
        <span class="token comment">-- q: out std_logic_vector(11 downto 0);</span>
        <span class="token comment">-- btnout_temp: out std_logic;</span>
        <span class="token comment">-- clktmp: out std_logic</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span> <span class="token keyword">entity</span><span class="token punctuation">;</span>

<span class="token keyword">architecture</span> rtl <span class="token keyword">of</span> D201GS10_RandomNumber <span class="token keyword">is</span>
    <span class="token keyword">signal</span> feedback <span class="token punctuation">:</span> std_logic<span class="token punctuation">;</span>
    <span class="token keyword">signal</span> q_temp <span class="token punctuation">:</span> <span class="token function">std_logic_vector</span><span class="token punctuation">(</span><span class="token number">11</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- is for M sequence</span>
    <span class="token keyword">signal</span> q_temp4 <span class="token punctuation">:</span> <span class="token function">std_logic_vector</span><span class="token punctuation">(</span><span class="token number">11</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- is for M sequence</span>
    <span class="token keyword">signal</span> q_temp2 <span class="token punctuation">:</span> <span class="token function">std_logic_vector</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:=</span> <span class="token vhdl-vectors number">"000"</span><span class="token punctuation">;</span> <span class="token comment">-- is for count8/seg</span>
    <span class="token keyword">signal</span> qo <span class="token punctuation">:</span> <span class="token function">std_logic_vector</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:=</span> <span class="token vhdl-vectors number">"0000"</span><span class="token punctuation">;</span> <span class="token comment">-- is for count8/seg M sequence</span>
    <span class="token keyword">signal</span> qs <span class="token punctuation">:</span> <span class="token function">std_logic_vector</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:=</span> <span class="token vhdl-vectors number">"0000"</span><span class="token punctuation">;</span> <span class="token comment">-- is for count8/seg M sequence</span>
    <span class="token keyword">signal</span> qt <span class="token punctuation">:</span> <span class="token function">std_logic_vector</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:=</span> <span class="token vhdl-vectors number">"0000"</span><span class="token punctuation">;</span> <span class="token comment">-- is for count8/seg M sequence</span>
    <span class="token comment">-- signal q_temp3 : std_logic_vector(2 downto 0) := "000"; -- is for debouncing</span>
    <span class="token keyword">signal</span> clk_2s <span class="token punctuation">:</span> std_logic <span class="token operator">:=</span> <span class="token number">'0'</span><span class="token punctuation">;</span>
    
    <span class="token keyword">signal</span> btnout <span class="token punctuation">:</span> std_logic<span class="token punctuation">;</span>
    <span class="token keyword">signal</span> num<span class="token punctuation">:</span> integer <span class="token keyword">range</span> <span class="token number">0</span> <span class="token keyword">to</span> <span class="token number">99</span><span class="token punctuation">;</span> <span class="token comment">-- is for debouncing</span>
    <span class="token keyword">signal</span> num4<span class="token punctuation">:</span> integer <span class="token keyword">range</span> <span class="token number">0</span> <span class="token keyword">to</span> <span class="token number">1999</span><span class="token punctuation">;</span> <span class="token comment">-- is for debouncing</span>
    <span class="token keyword">signal</span> num2<span class="token punctuation">:</span> integer <span class="token keyword">range</span> <span class="token operator">-</span><span class="token number">999</span> <span class="token keyword">to</span> <span class="token number">999</span><span class="token punctuation">;</span> <span class="token comment">-- is for divider2000</span>
    <span class="token keyword">signal</span> num3<span class="token punctuation">:</span> integer <span class="token keyword">range</span> <span class="token number">0</span> <span class="token keyword">to</span> <span class="token number">999</span><span class="token punctuation">;</span> <span class="token comment">-- is for divider2000</span>
    <span class="token keyword">signal</span> seg_temp<span class="token punctuation">:</span> <span class="token function">std_logic_vector</span><span class="token punctuation">(</span><span class="token number">7</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">signal</span> cat_temp<span class="token punctuation">:</span> <span class="token function">std_logic_vector</span><span class="token punctuation">(</span><span class="token number">7</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">signal</span> flag<span class="token punctuation">:</span> std_logic<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
	divider<span class="token punctuation">:</span> <span class="token keyword">process</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span>clk_2s<span class="token punctuation">,</span>num2<span class="token punctuation">,</span>num3<span class="token punctuation">,</span>btnout<span class="token punctuation">)</span> <span class="token keyword">begin</span>
		<span class="token keyword">if</span> clk<span class="token attribute attr-name">'event</span> <span class="token operator">and</span> clk<span class="token operator">=</span><span class="token number">'1'</span> <span class="token keyword">then</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>btnout <span class="token operator">=</span> <span class="token number">'1'</span><span class="token punctuation">)</span> <span class="token keyword">then</span> num2 <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">999</span><span class="token punctuation">;</span>clk_2s <span class="token operator">&lt;=</span> <span class="token number">'0'</span><span class="token punctuation">;</span>
			<span class="token keyword">elsif</span> num2 <span class="token operator">=</span> <span class="token number">999</span> <span class="token keyword">then</span> <span class="token comment">--*2=divider num</span>
				num2 <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>clk_2s <span class="token operator">&lt;=</span> <span class="token operator">not</span> clk_2s<span class="token punctuation">;</span>
			<span class="token keyword">else</span>
				num2 <span class="token operator">&lt;=</span> num2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
		<span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
	<span class="token keyword">end</span> <span class="token keyword">process</span><span class="token punctuation">;</span>

    debouncing1<span class="token punctuation">:</span> <span class="token keyword">process</span> <span class="token punctuation">(</span>clk<span class="token punctuation">,</span>btn<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token keyword">if</span> <span class="token function">rising_edge</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token keyword">if</span> btn<span class="token operator">=</span><span class="token number">'1'</span> <span class="token keyword">then</span>
                <span class="token keyword">if</span> num <span class="token operator">=</span> <span class="token number">99</span> <span class="token keyword">then</span> num <span class="token operator">&lt;=</span> <span class="token number">99</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> num <span class="token operator">&lt;=</span> num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> 
                num <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
      <span class="token keyword">end</span> <span class="token keyword">process</span><span class="token punctuation">;</span>
      
    debouncing2<span class="token punctuation">:</span> <span class="token keyword">process</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span>num<span class="token punctuation">,</span>btnout<span class="token punctuation">,</span>num4<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token keyword">if</span> <span class="token function">rising_edge</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token keyword">if</span> num <span class="token operator">></span> <span class="token number">30</span> <span class="token keyword">then</span> btnout <span class="token operator">&lt;=</span> <span class="token number">'1'</span><span class="token punctuation">;</span>num4 <span class="token operator">&lt;=</span> num4 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">elsif</span><span class="token punctuation">(</span>num4 <span class="token operator">&lt;</span> <span class="token number">1999</span> <span class="token operator">and</span> num4 <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">then</span> num4 <span class="token operator">&lt;=</span> num4 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>btnout <span class="token operator">&lt;=</span> <span class="token number">'1'</span><span class="token punctuation">;</span>
            <span class="token keyword">elsif</span><span class="token punctuation">(</span>num4 <span class="token operator">=</span> <span class="token number">1999</span><span class="token punctuation">)</span> <span class="token keyword">then</span> btnout <span class="token operator">&lt;=</span> <span class="token number">'0'</span><span class="token punctuation">;</span>num4 <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> btnout <span class="token operator">&lt;=</span> <span class="token number">'0'</span><span class="token punctuation">;</span>num4 <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">process</span><span class="token punctuation">;</span>

    randomNum1<span class="token punctuation">:</span> <span class="token keyword">process</span> <span class="token punctuation">(</span>q_temp<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>q_temp<span class="token operator">=</span><span class="token vhdl-vectors number">"000000000000"</span><span class="token punctuation">)</span> <span class="token keyword">then</span> feedback <span class="token operator">&lt;=</span> <span class="token number">'1'</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> feedback <span class="token operator">&lt;=</span> <span class="token function">q_temp</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">xor</span> <span class="token function">q_temp</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">xor</span> <span class="token function">q_temp</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">xor</span> <span class="token function">q_temp</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">process</span><span class="token punctuation">;</span>
    
    randomNum2<span class="token punctuation">:</span> <span class="token keyword">process</span> <span class="token punctuation">(</span>clk<span class="token punctuation">,</span>feedback<span class="token punctuation">,</span>q_temp<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token comment">-- clk's period should be 2s,freq=0.5Hz;it is from 1kHz divider 2000</span>
        <span class="token keyword">if</span> clk<span class="token attribute attr-name">'event</span> <span class="token operator">and</span> clk<span class="token operator">=</span><span class="token number">'1'</span> <span class="token keyword">then</span> 
			q_temp <span class="token operator">&lt;=</span> <span class="token function">q_temp</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token keyword">downto</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> feedback<span class="token punctuation">;</span>      
        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">process</span><span class="token punctuation">;</span>

    count8<span class="token punctuation">:</span><span class="token keyword">process</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>clk<span class="token attribute attr-name">'event</span> <span class="token operator">and</span> clk<span class="token operator">=</span><span class="token number">'1'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token keyword">if</span> q_temp2 <span class="token operator">=</span> <span class="token vhdl-vectors number">"111"</span> <span class="token keyword">then</span> q_temp2 <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"000"</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> 
                q_temp2 <span class="token operator">&lt;=</span> q_temp2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">process</span><span class="token punctuation">;</span>

    transfer<span class="token punctuation">:</span> <span class="token keyword">process</span><span class="token punctuation">(</span>clk_2s<span class="token punctuation">,</span>q_temp4<span class="token punctuation">,</span>q_temp<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rising_edge</span><span class="token punctuation">(</span>clk_2s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">then</span> q_temp4 <span class="token operator">&lt;=</span> q_temp<span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">process</span><span class="token punctuation">;</span>

    decode<span class="token punctuation">:</span><span class="token keyword">process</span><span class="token punctuation">(</span>qo<span class="token punctuation">,</span>qs<span class="token punctuation">,</span>qt<span class="token punctuation">,</span>q_temp4<span class="token punctuation">,</span>q_temp2<span class="token punctuation">,</span>btnout<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        qo <span class="token operator">&lt;=</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        qs <span class="token operator">&lt;=</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        qt <span class="token operator">&lt;=</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token function">q_temp4</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> q_temp2 <span class="token keyword">is</span>
            <span class="token keyword">when</span> <span class="token vhdl-vectors number">"000"</span> <span class="token operator">=</span><span class="token operator">></span> cat_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01111111"</span><span class="token punctuation">;</span>seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11011010"</span><span class="token punctuation">;</span> <span class="token comment">--2</span>
            <span class="token keyword">when</span> <span class="token vhdl-vectors number">"001"</span> <span class="token operator">=</span><span class="token operator">></span> cat_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"10111111"</span><span class="token punctuation">;</span>seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111100"</span><span class="token punctuation">;</span> <span class="token comment">--0</span>
            <span class="token keyword">when</span> <span class="token vhdl-vectors number">"010"</span> <span class="token operator">=</span><span class="token operator">></span> cat_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11011111"</span><span class="token punctuation">;</span>seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100000"</span><span class="token punctuation">;</span> <span class="token comment">--1</span>
            <span class="token keyword">when</span> <span class="token vhdl-vectors number">"011"</span> <span class="token operator">=</span><span class="token operator">></span> cat_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11101111"</span><span class="token punctuation">;</span>seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100000"</span><span class="token punctuation">;</span> <span class="token comment">--1</span>
            <span class="token keyword">when</span> <span class="token vhdl-vectors number">"100"</span> <span class="token operator">=</span><span class="token operator">></span> cat_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11110111"</span><span class="token punctuation">;</span>seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111100"</span><span class="token punctuation">;</span> <span class="token comment">--0</span>
            <span class="token keyword">when</span> <span class="token vhdl-vectors number">"101"</span> <span class="token operator">=</span><span class="token operator">></span> cat_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111011"</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>btnout<span class="token operator">=</span><span class="token number">'1'</span><span class="token punctuation">)</span> <span class="token keyword">then</span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111100"</span><span class="token punctuation">;</span> <span class="token comment">--0</span>
                <span class="token keyword">else</span>
                    <span class="token keyword">case</span> qo <span class="token keyword">is</span> 
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0000"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111100"</span><span class="token punctuation">;</span> <span class="token comment">--0</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0001"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100000"</span><span class="token punctuation">;</span> <span class="token comment">--1</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0010"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11011010"</span><span class="token punctuation">;</span>  <span class="token comment">--2</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0011"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11110010"</span><span class="token punctuation">;</span>  <span class="token comment">--3</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0100"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100110"</span><span class="token punctuation">;</span>  <span class="token comment">--4</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0101"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"10110110"</span><span class="token punctuation">;</span>  <span class="token comment">--5</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0110"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"10111110"</span><span class="token punctuation">;</span>  <span class="token comment">--6</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0111"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11100000"</span><span class="token punctuation">;</span>  <span class="token comment">--7</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1000"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111110"</span><span class="token punctuation">;</span>  <span class="token comment">--8</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1001"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11110110"</span><span class="token punctuation">;</span>  <span class="token comment">--9</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1010"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111100"</span><span class="token punctuation">;</span> <span class="token comment">--0</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1011"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100000"</span><span class="token punctuation">;</span> <span class="token comment">--1</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1100"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11011010"</span><span class="token punctuation">;</span>  <span class="token comment">--2</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1101"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11110010"</span><span class="token punctuation">;</span>  <span class="token comment">--3</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1110"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100110"</span><span class="token punctuation">;</span>  <span class="token comment">--4</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1111"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"10110110"</span><span class="token punctuation">;</span>  <span class="token comment">--5</span>
                        <span class="token keyword">when</span> <span class="token keyword">others</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"00000000"</span><span class="token punctuation">;</span>
                    <span class="token keyword">end</span> <span class="token keyword">case</span><span class="token punctuation">;</span> 
                <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
            <span class="token keyword">when</span> <span class="token vhdl-vectors number">"110"</span> <span class="token operator">=</span><span class="token operator">></span> cat_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111101"</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>btnout<span class="token operator">=</span><span class="token number">'1'</span><span class="token punctuation">)</span> <span class="token keyword">then</span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111100"</span><span class="token punctuation">;</span> <span class="token comment">--0</span>
                <span class="token keyword">else</span>
                    <span class="token keyword">case</span> qs <span class="token keyword">is</span> 
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0000"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111100"</span><span class="token punctuation">;</span> <span class="token comment">--0</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0001"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100000"</span><span class="token punctuation">;</span> <span class="token comment">--1</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0010"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11011010"</span><span class="token punctuation">;</span> <span class="token comment">--2</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0011"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11110010"</span><span class="token punctuation">;</span> <span class="token comment">--3</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0100"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100110"</span><span class="token punctuation">;</span> <span class="token comment">--4</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0101"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"10110110"</span><span class="token punctuation">;</span> <span class="token comment">--5</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0110"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"10111110"</span><span class="token punctuation">;</span> <span class="token comment">--6</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0111"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11100000"</span><span class="token punctuation">;</span> <span class="token comment">--7</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1000"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111110"</span><span class="token punctuation">;</span> <span class="token comment">--8</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1001"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11110110"</span><span class="token punctuation">;</span> <span class="token comment">--9</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1010"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111100"</span><span class="token punctuation">;</span> <span class="token comment">--0</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1011"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100000"</span><span class="token punctuation">;</span> <span class="token comment">--1</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1100"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11011010"</span><span class="token punctuation">;</span>  <span class="token comment">--2</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1101"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11110010"</span><span class="token punctuation">;</span>  <span class="token comment">--3</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1110"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100110"</span><span class="token punctuation">;</span>  <span class="token comment">--4</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1111"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"10110110"</span><span class="token punctuation">;</span>  <span class="token comment">--5</span>
                        <span class="token keyword">when</span> <span class="token keyword">others</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"00000000"</span><span class="token punctuation">;</span>
                    <span class="token keyword">end</span> <span class="token keyword">case</span><span class="token punctuation">;</span> 
                <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
            <span class="token keyword">when</span> <span class="token vhdl-vectors number">"111"</span> <span class="token operator">=</span><span class="token operator">></span> cat_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111110"</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>btnout<span class="token operator">=</span><span class="token number">'1'</span><span class="token punctuation">)</span> <span class="token keyword">then</span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111100"</span><span class="token punctuation">;</span> <span class="token comment">--0</span>
                <span class="token keyword">else</span>
                    <span class="token keyword">case</span> qt <span class="token keyword">is</span> 
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0000"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111100"</span><span class="token punctuation">;</span> <span class="token comment">--0</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0001"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100000"</span><span class="token punctuation">;</span> <span class="token comment">--1</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0010"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span><span class="token vhdl-vectors number">"11011010"</span><span class="token punctuation">;</span>  <span class="token comment">--2</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0011"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11110010"</span><span class="token punctuation">;</span> <span class="token comment">--3</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0100"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100110"</span><span class="token punctuation">;</span> <span class="token comment">--4</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0101"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"10110110"</span><span class="token punctuation">;</span> <span class="token comment">--5</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0110"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"10111110"</span><span class="token punctuation">;</span> <span class="token comment">--6</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"0111"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11100000"</span><span class="token punctuation">;</span> <span class="token comment">--7</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1000"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111110"</span><span class="token punctuation">;</span> <span class="token comment">--8</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1001"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11110110"</span><span class="token punctuation">;</span> <span class="token comment">--9</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1010"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11111100"</span><span class="token punctuation">;</span> <span class="token comment">--0</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1011"</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100000"</span><span class="token punctuation">;</span> <span class="token comment">--1</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1100"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11011010"</span><span class="token punctuation">;</span>  <span class="token comment">--2</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1101"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"11110010"</span><span class="token punctuation">;</span>  <span class="token comment">--3</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1110"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"01100110"</span><span class="token punctuation">;</span>  <span class="token comment">--4</span>
                        <span class="token keyword">when</span> <span class="token vhdl-vectors number">"1111"</span><span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"10110110"</span><span class="token punctuation">;</span>  <span class="token comment">--5</span>
                        <span class="token keyword">when</span> <span class="token keyword">others</span> <span class="token operator">=</span><span class="token operator">></span> seg_temp <span class="token operator">&lt;=</span> <span class="token vhdl-vectors number">"00000000"</span><span class="token punctuation">;</span>
                    <span class="token keyword">end</span> <span class="token keyword">case</span><span class="token punctuation">;</span> 
                <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">case</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">process</span> decode<span class="token punctuation">;</span>
    seg <span class="token operator">&lt;=</span> seg_temp<span class="token punctuation">;</span>
    cat <span class="token operator">&lt;=</span> cat_temp<span class="token punctuation">;</span>
    <span class="token comment">-- btnout_temp &lt;= btnout;</span>
    <span class="token comment">-- q &lt;= q_temp4;</span>
    <span class="token comment">-- clktmp &lt;= clk_2s;</span>
    <span class="token comment">-- numtmp &lt;= num4;</span>
<span class="token keyword">end</span> <span class="token keyword">architecture</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="工程文件截图" tabindex="-1"><a class="header-anchor" href="#工程文件截图" aria-hidden="true">#</a> 工程文件截图：</h3>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602225112266.png" alt="image-20220602225112266" loading="lazy"></p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602224938100.png" alt="image-20220602224938100" loading="lazy"></p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602225200053.png" alt="image-20220602225200053" loading="lazy"></p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602225226508.png" alt="image-20220602225226508" loading="lazy"></p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602225246364.png" alt="image-20220602225246364" loading="lazy"></p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602200631559.png" alt="image-20220602200631559" loading="lazy"></p>
<h2 id="仿真波形图及分析、结论" tabindex="-1"><a class="header-anchor" href="#仿真波形图及分析、结论" aria-hidden="true">#</a> 仿真波形图及分析、结论</h2>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602200815209.png" alt="image-20220602200815209" loading="lazy"></p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602202051320.png" alt="image-20220602202051320" loading="lazy"></p>
<p>从上图可以看出，位码大概每1ms切换一次，正确实现了动态扫描数码管。再看位码，初始显示&quot;20110000&quot;，也能正确译码。</p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602203300776.png" alt="image-20220602203300776" loading="lazy"></p>
<p>将时间轴移动到2s处，得到上图，可以看出2s后后三位随机数已经变化。</p>
<p>如果在1s左右处按键按下，如下图：</p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602203738759.png" alt="image-20220602203738759" loading="lazy"></p>
<p>仿真后：</p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602204050164.png" alt="image-20220602204050164" loading="lazy"></p>
<p>可以看到此时即使时间来到3s左右，随机数仍保持“000”，说明按键可以实现复位，且复位保持2s。</p>
<h2 id="实验中遇到的问题及解决方法" tabindex="-1"><a class="header-anchor" href="#实验中遇到的问题及解决方法" aria-hidden="true">#</a> 实验中遇到的问题及解决方法</h2>
<h3 id="_1-vhdl编译报错" tabindex="-1"><a class="header-anchor" href="#_1-vhdl编译报错" aria-hidden="true">#</a> 1.vhdl编译报错</h3>
<p><strong>can't infer register for temp_temp[0] at D201GS10_RandomNumber.vhd(87) because it does not hold its value outside the clock edge</strong></p>
<p>无法推断寄存器，因为它的值不在时钟边缘之外.</p>
<p>需要注意几个点：</p>
<ul>
<li>判断时钟上升沿的if语句，不能携带else；</li>
<li>同一个信号的赋值不能出现在多个进程里，一个进程里“写”，其他进程只能“读”；</li>
<li>按键清零（复位）应该是电平触发，而不是边沿触发。</li>
</ul>
<h3 id="_2-下载到开发板上时数码管乱码" tabindex="-1"><a class="header-anchor" href="#_2-下载到开发板上时数码管乱码" aria-hidden="true">#</a> 2.下载到开发板上时数码管乱码</h3>
<p>在检查自己的程序、仿真分析确定无误后，最后发现段码的引脚配置错误。</p>
<p>根据实验板说明书：</p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602212130607.png" alt="image-20220602212130607" loading="lazy"></p>
<p>如要想01100000表示“1”，则seg: abcdefgp，只有bc亮，</p>
<p>seg[7] -&gt; a -&gt; PIN_62</p>
<p>seg[6] -&gt; b -&gt; PIN_59</p>
<p>...</p>
<p>注意左边起是高位，如“01100000”中，seg[7]=0,seg[6]=1,seg[5]=1.</p>
<p>最后的配置应该如下：</p>
<p><img src="@source/课程实验/数电实验/随机数生成及显示电路的设计与实现.assets/image-20220602220550763.png" alt="image-20220602220550763" loading="lazy"></p>
<h3 id="_3-随机数显示译码是二进制数" tabindex="-1"><a class="header-anchor" href="#_3-随机数显示译码是二进制数" aria-hidden="true">#</a> 3.随机数显示译码是二进制数</h3>
<p>注意应译码成十进制数。</p>
<h3 id="_4-每次清零后的显示都一样" tabindex="-1"><a class="header-anchor" href="#_4-每次清零后的显示都一样" aria-hidden="true">#</a> 4.每次清零后的显示都一样</h3>
<p>清零不要清M序列，只清显示。M序列的时钟用高频，每2s读取M序列的结果取显示</p>
<h3 id="_5-清零后显示的第一组随机数持续时间不是2秒" tabindex="-1"><a class="header-anchor" href="#_5-清零后显示的第一组随机数持续时间不是2秒" aria-hidden="true">#</a> 5.清零后显示的第一组随机数持续时间不是2秒</h3>
<p>按键复位时，分频器中的分频信号也应该清零。</p>
<h2 id="总结及感想" tabindex="-1"><a class="header-anchor" href="#总结及感想" aria-hidden="true">#</a> 总结及感想</h2>
<ul>
<li>这次的随机数实验不仅巩固了之前学习的数码管（动态扫描）、计数器、分频器，又结合与应用了新的知识点：M序列发生器。经过这次实验，我对之前学习的特别是数码管的动态扫描有了更深的理解。</li>
<li>这次实验做得较为坎坷，主要在三个地方：一是vhdl编译报错，纠错花费了大量时间；二是数码管段码引脚配置顺序相反，导致实验板上显示译码乱码，花费了不少时间定位到这个错误；三是优化细节，如清零时间要保持2s、清零后第一组随机数不能跟上次相同、清零后第一组随机数也要保持2s。</li>
<li>初学阶段，老师、同学的帮助很重要，我们要对每一个给我们debug的人心存感激；当然我认为必须在自己尝试、摸索之后才有资格想他人寻求帮助。</li>
</ul>
</div></template>


